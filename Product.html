<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Laser / CNC Profit Planner</title>
  <style>
    :root{
      --bg:#0b0f12; --panel:#0f1418; --muted:#98a0a6; --accent:#6ee7b7; --input:#121519; --card:#0e1316;
      --glass: rgba(255,255,255,0.03);
      --width-input: 140px;
    }
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071017 0%,#071217 60%);color:#e6eef1}
    a{color:var(--accent)}
    .app{display:flex;min-height:100vh}

    /* LEFT (fixed) */
    .left{width:420px;flex-shrink:0;padding:28px;border-right:1px solid rgba(255,255,255,0.03);position:sticky;top:0;height:100vh;overflow:auto;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .logo{font-weight:700;font-size:18px;margin-bottom:18px;display:flex;align-items:center;gap:10px}
    .card{background:var(--card);border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 6px 18px rgba(3,6,8,0.6)}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=number]{background:var(--input);border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;color:#e6eef1;width:100%;outline:none}
    .row{display:flex;gap:10px;align-items:center}
    .two{display:flex;gap:10px}
    .small{width:110px}
    .field-inline{display:flex;flex-direction:column}
    .muted{font-size:12px;color:var(--muted)}

    /* RIGHT (products) */
    .right{flex:1;padding:26px;overflow:auto}
    .controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .products{display:flex;flex-direction:column;gap:12px}
    .product{background:var(--glass);border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px}
    .prod-top{display:flex;gap:12px;align-items:center}
    .prod-grid{display:flex;flex-wrap:wrap;gap:8px}
    .prod-grid .field-inline{min-width:140px}

    /* condensed inputs */
    .compact input{width:var(--width-input)}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--accent);cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .danger{color:#ff7b7b;border-color:rgba(255,123,123,0.12)}

    /* summary */
    .bignum{font-size:22px;font-weight:700}
    .progress{height:12px;background:rgba(255,255,255,0.04);border-radius:8px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#4cc1ff);width:0%}

    footer{font-size:12px;color:var(--muted);margin-top:18px}

    /* responsive */
    @media (max-width:920px){.left{position:relative;width:100%;height:auto}.app{flex-direction:column}.right{padding:12px}}

    /* small helpers */
    .row-between{display:flex;justify-content:space-between;align-items:center}
    .tiny{font-size:12px;color:var(--muted)}
    .iconbtn{background:none;border:none;color:var(--muted);cursor:pointer;padding:6px}
  </style>
</head>
<body>
  <div class="app">
    <aside class="left">
      <div class="logo">
  <img src="JITS Clear BG.png" alt="My Logo" style="height:52px; width:auto; border-radius:6px; margin-right:8px;">
  Laser & CNC Profit Planner
</div>


      <div class="card">
        <label>Monthly profit goal</label>
        <input id="goal" type="number" step="0.01" value="10000" />
      </div>

      <div class="card">
        <label>Man-hour (labor) rate $ / hour</label>
        <input id="manRate" type="number" step="0.01" value="25" />
      </div>

      <div class="card">
        <label>Machine hourly rate $ / hour</label>
        <input id="machineRate" type="number" step="0.01" value="40" />
      </div>

      <div class="card">
        <label>Platform & fees (percent of sale)</label>
        <div class="two">
          <div style="flex:1"><label class="tiny">Etsy / Platform %</label><input id="etsyFee" type="number" step="0.01" value="6.5"/></div>
          <div style="flex:1"><label class="tiny">Bank / Processing %</label><input id="bankFee" type="number" step="0.01" value="2.9"/></div>
        </div>
        <div class="two" style="margin-top:8px">
          <div style="flex:1"><label class="tiny">Website Fee %</label><input id="siteFee" type="number" step="0.01" value="0.0"/></div>
          <div style="flex:1"><label class="tiny">Marketing %</label><input id="marketingFee" type="number" step="0.01" value="5.0"/></div>
        </div>
      </div>

      <div class="card">
        <div class="row-between"><div><div class="tiny">Overall monthly progress</div><div class="bignum" id="totalMonthly">$0.00</div></div>
          <div class="tiny">Goal: <span id="goalShow">$10,000.00</span></div></div>
        <div style="margin-top:8px" class="progress"><i id="progressBar"></i></div>
        <div style="margin-top:8px" class="tiny">Total unit profit: <span id="totalUnitProfit">$0.00</span></div>
      </div>

      <div class="card">
        <div class="row-between"><strong>Data</strong>
          <div>
            <button class="btn" id="exportBtn">Export CSV</button>
            <button class="btn" id="importBtn">Import CSV</button>
            <input id="importFile" type="file" accept="text/csv" style="display:none" />
          </div>
        </div>
      </div>
      <footer>© 2025 Jack In The Shop. All rights reserved.</footer>
    </aside>

    <main class="right">
      <div class="controls">
        <div><strong>Products</strong><div class="tiny">Add as many product lines as needed</div></div>
        <div>
          <button class="btn" id="addProduct">+ Add product</button>
          <button class="btn" id="clearAll">Clear all</button>
        </div>
      </div>

      <div class="products" id="products"></div>

      <template id="productTpl">
        <div class="product">
          <div class="prod-top row-between">
            <div style="display:flex;gap:10px;align-items:center">
              <input class="prod-name" type="text" placeholder="Product name" style="width:220px;background:var(--input);border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.03)" />
              <button class="iconbtn remove">✖</button>
            </div>
            <div class="tiny">Monthly profit: <strong class="prod-monthly">$0.00</strong></div>
          </div>

          <div class="prod-grid">
            <div class="field-inline compact"><label>Sell price $</label><input class="sellPrice" type="number" step="0.01" value="25" /></div>
            <div class="field-inline compact"><label>Setup fee $</label><input class="setupFee" type="number" step="0.01" value="0" /></div>
            <div class="field-inline compact"><label>Units / month</label><input class="units" type="number" step="1" value="10" /></div>

            <div class="field-inline compact"><label>Material</label><input class="materialName" type="text" placeholder="e.g., maple" /></div>
            <div class="field-inline compact"><label>Material cost $</label><input class="materialCost" type="number" step="0.01" value="3" /></div>

            <div class="field-inline compact"><label>Ship mat</label><input class="shipMat" type="text" placeholder="box, mailer" /></div>
            <div class="field-inline compact"><label>Ship cost $</label><input class="shipCost" type="number" step="0.01" value="2" /></div>

            <div class="field-inline compact"><label>Design (min)</label><input class="designMin" type="number" step="1" value="5" /></div>
            <div class="field-inline compact"><label>Setup (min)</label><input class="setupMin" type="number" step="1" value="5" /></div>
            <div class="field-inline compact"><label>Finish (min)</label><input class="finishMin" type="number" step="1" value="5" /></div>
            <div class="field-inline compact"><label>Packing (min)</label><input class="packMin" type="number" step="1" value="5" /></div>
            <div class="field-inline compact"><label>Machine (min)</label><input class="machineMin" type="number" step="1" value="10" /></div>

            <div class="field-inline compact"><label>Notes</label><input class="notes" type="text" placeholder="optional" /></div>
          </div>
        </div>
      </template>

    </main>
  </div>

  <script>
    // Utilities
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const productsEl = document.getElementById('products');
    const tpl = document.getElementById('productTpl');

    // Default: create one product
    function createProduct(data = {}){
      const node = tpl.content.firstElementChild.cloneNode(true);
      productsEl.appendChild(node);
      const el = productsEl.lastElementChild;
      const map = {
        name: el.querySelector('.prod-name'), price: el.querySelector('.sellPrice'), setupFee: el.querySelector('.setupFee'), units: el.querySelector('.units'),
        materialName: el.querySelector('.materialName'), materialCost: el.querySelector('.materialCost'), shipMat: el.querySelector('.shipMat'), shipCost: el.querySelector('.shipCost'),
        designMin: el.querySelector('.designMin'), setupMin: el.querySelector('.setupMin'), finishMin: el.querySelector('.finishMin'), packMin: el.querySelector('.packMin'), machineMin: el.querySelector('.machineMin'),
        notes: el.querySelector('.notes'), monthlyDisplay: el.querySelector('.prod-monthly')
      };

      // set defaults
      map.name.value = data.name || '';
      map.price.value = data.price ?? 25;
      map.setupFee.value = data.setupFee ?? 0;
      map.units.value = data.units ?? 10;
      map.materialName.value = data.materialName || '';
      map.materialCost.value = data.materialCost ?? 3;
      map.shipMat.value = data.shipMat || '';
      map.shipCost.value = data.shipCost ?? 2;
      map.designMin.value = data.designMin ?? 5;
      map.setupMin.value = data.setupMin ?? 5;
      map.finishMin.value = data.finishMin ?? 5;
      map.packMin.value = data.packMin ?? 5;
      map.machineMin.value = data.machineMin ?? 10;
      map.notes.value = data.notes || '';

      function attach(){
        ['input'].forEach(evt => el.addEventListener(evt, recalc));
        el.querySelector('.remove').addEventListener('click', ()=>{el.remove();recalc();});
      }
      attach();
      recalc();
      return el;
    }

    // add controls
    $('#addProduct').addEventListener('click', ()=>createProduct());
    $('#clearAll').addEventListener('click', ()=>{productsEl.innerHTML='';recalc();});

    // export/import
    function gatherState(){
      const settings = {
        goal: parseFloat($('#goal').value)||0,
        manRate: parseFloat($('#manRate').value)||0,
        machineRate: parseFloat($('#machineRate').value)||0,
        etsyFee: parseFloat($('#etsyFee').value)||0,
        bankFee: parseFloat($('#bankFee').value)||0,
        siteFee: parseFloat($('#siteFee').value)||0,
        marketingFee: parseFloat($('#marketingFee').value)||0
      };
      const products = [];
      productsEl.querySelectorAll('.product').forEach(p=>{
        products.push({
          name: p.querySelector('.prod-name').value,
          price: parseFloat(p.querySelector('.sellPrice').value)||0,
          setupFee: parseFloat(p.querySelector('.setupFee').value)||0,
          units: parseInt(p.querySelector('.units').value)||0,
          materialName: p.querySelector('.materialName').value,
          materialCost: parseFloat(p.querySelector('.materialCost').value)||0,
          shipMat: p.querySelector('.shipMat').value,
          shipCost: parseFloat(p.querySelector('.shipCost').value)||0,
          designMin: parseFloat(p.querySelector('.designMin').value)||0,
          setupMin: parseFloat(p.querySelector('.setupMin').value)||0,
          finishMin: parseFloat(p.querySelector('.finishMin').value)||0,
          packMin: parseFloat(p.querySelector('.packMin').value)||0,
          machineMin: parseFloat(p.querySelector('.machineMin').value)||0,
          notes: p.querySelector('.notes').value
        });
      });
      return {settings,products};
    }

    function exportCSV(){
      const state = gatherState();
      // CSV format: first block SETTINGS,key,value per line; then a blank line; then PRODUCTS header and rows
      let lines = [];
      lines.push('SETTINGS');
      for(const k in state.settings) lines.push(`${k},${state.settings[k]}`);
      lines.push('');
      lines.push('PRODUCTS');
      const header = ['name','price','setupFee','units','materialName','materialCost','shipMat','shipCost','designMin','setupMin','finishMin','packMin','machineMin','notes'];
      lines.push(header.join(','));
      state.products.forEach(p=>{
        lines.push(header.map(h=>`"${String(p[h] ?? '')}"`).join(','));
      });
      const blob = new Blob([lines.join('\n')],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'laser_cnc_plan.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    function importCSV(file){
      const reader = new FileReader();
      reader.onload = e=>{
        const txt = e.target.result;
        const rows = txt.split(/\r?\n/).map(r=>r.trim());
        // simple parser
        let i=0; const settings = {};
        if(rows[i]==='SETTINGS'){i++; while(i<rows.length && rows[i]!==''){ const [k,v]=rows[i].split(','); if(k) settings[k]=parseFloat(v); i++; }}
        // find PRODUCTS
        while(i<rows.length && rows[i]!=='PRODUCTS') i++;
        i++;// skip PRODUCTS
        const header = rows[i] ? rows[i].split(',') : []; i++;
        const prods = [];
        for(;i<rows.length;i++){
          const row = rows[i]; if(!row) continue;
          // split by comma but remove surrounding quotes
          const cols = row.match(/("[^"]*"|[^,]+)/g).map(c=>c.replace(/^"|"$/g, ''));
          const obj = {};
          header.forEach((h,idx)=>{ obj[h]=cols[idx] ?? ''; });
          // convert numeric fields
          ['price','setupFee','units','materialCost','shipCost','designMin','setupMin','finishMin','packMin','machineMin'].forEach(k=>{ obj[k]=parseFloat(obj[k])||0; });
          prods.push(obj);
        }
        // apply
        if(settings.goal!=null) $('#goal').value = settings.goal||0;
        if(settings.manRate!=null) $('#manRate').value = settings.manRate||0;
        if(settings.machineRate!=null) $('#machineRate').value = settings.machineRate||0;
        if(settings.etsyFee!=null) $('#etsyFee').value = settings.etsyFee||0;
        if(settings.bankFee!=null) $('#bankFee').value = settings.bankFee||0;
        if(settings.siteFee!=null) $('#siteFee').value = settings.siteFee||0;
        if(settings.marketingFee!=null) $('#marketingFee').value = settings.marketingFee||0;

        productsEl.innerHTML='';
        prods.forEach(p=>createProduct(p));
        recalc();
      };
      reader.readAsText(file);
    }

    $('#exportBtn').addEventListener('click', exportCSV);
    $('#importBtn').addEventListener('click', ()=>$('#importFile').click());
    $('#importFile').addEventListener('change', e=>{ if(e.target.files[0]) importCSV(e.target.files[0]); e.target.value=''; });

    // core calc
    function recalc(){
      const manRate = parseFloat($('#manRate').value)||0;
      const machineRate = parseFloat($('#machineRate').value)||0;
      const etsy = (parseFloat($('#etsyFee').value)||0)/100;
      const bank = (parseFloat($('#bankFee').value)||0)/100;
      const site = (parseFloat($('#siteFee').value)||0)/100;
      const marketing = (parseFloat($('#marketingFee').value)||0)/100;

      let totalMonthly = 0; let totalUnitProfit = 0; let totalUnits = 0;

      productsEl.querySelectorAll('.product').forEach(p=>{
        const price = parseFloat(p.querySelector('.sellPrice').value)||0;
        const setupFee = parseFloat(p.querySelector('.setupFee').value)||0;
        const units = parseInt(p.querySelector('.units').value)||0;
        const materialCost = parseFloat(p.querySelector('.materialCost').value)||0;
        const shipCost = parseFloat(p.querySelector('.shipCost').value)||0;
        const designMin = parseFloat(p.querySelector('.designMin').value)||0;
        const setupMin = parseFloat(p.querySelector('.setupMin').value)||0;
        const finishMin = parseFloat(p.querySelector('.finishMin').value)||0;
        const packMin = parseFloat(p.querySelector('.packMin').value)||0;
        const machineMin = parseFloat(p.querySelector('.machineMin').value)||0;

        // fees on sale
        const fees = price * (etsy + bank + site + marketing);
        // per-unit setup amortized
        const perUnitSetup = units>0 ? (setupFee / units) : setupFee;
        // labor cost
        const laborCost = ((designMin + setupMin + finishMin + packMin)/60) * manRate;
        // machine cost
        const mCost = (machineMin/60) * machineRate;

        const unitProfit = price - materialCost - shipCost - perUnitSetup - laborCost - mCost - fees;
        const monthly = unitProfit * units;

        p.querySelector('.prod-monthly').textContent = `$${monthly.toFixed(2)}`;
        totalMonthly += monthly;
        totalUnitProfit += unitProfit * units; // same as monthly but summing for safety
        totalUnits += units;
      });

      totalUnitProfit = totalUnits>0 ? (totalUnitProfit / totalUnits) : 0;

      $('#totalMonthly').textContent = `$${totalMonthly.toFixed(2)}`;
      $('#goalShow').textContent = `$${(parseFloat($('#goal').value)||0).toFixed(2)}`;
      $('#totalUnitProfit').textContent = `$${totalUnitProfit.toFixed(2)}`;

      const goal = parseFloat($('#goal').value)||0;
      const pct = goal>0 ? Math.min(100, (totalMonthly/goal)*100) : 0;
      $('#progressBar').style.width = pct + '%';
    }

    // initial
    createProduct();

    // live recalc on left inputs
    ['goal','manRate','machineRate','etsyFee','bankFee','siteFee','marketingFee'].forEach(id=>$('#'+id).addEventListener('input', recalc));

    // observe product changes
    productsEl.addEventListener('input', recalc);

    // keyboard: allow duplicate product by ctrl+d when focused
    document.addEventListener('keydown', e=>{
      if(e.ctrlKey && e.key.toLowerCase()==='d'){
        const active = document.activeElement.closest('.product');
        if(active){
          const p = {};
          ['prod-name','sellPrice','setupFee','units','materialName','materialCost','shipMat','shipCost','designMin','setupMin','finishMin','packMin','machineMin','notes'].forEach(k=>{
            const el = active.querySelector('.'+k);
            if(el) p[k.replace('prod-name','name').replace('sellPrice','price')] = el.value;
          });
          createProduct(p);
        }
      }
    });

    // ensure inputs share same styling color - already via CSS
    // initial calc
    recalc();
  </script>
</body>
</html>
